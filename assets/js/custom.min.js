function _post(params) { var form = document.createElement("form"); form.setAttribute("method", 'post'); form.setAttribute("action", ''); for(var key in params) { if(params.hasOwnProperty(key)) { var hiddenField = document.createElement("input"); hiddenField.setAttribute("type", "hidden"); hiddenField.setAttribute("name", key); hiddenField.setAttribute("value", params[key]); form.appendChild(hiddenField); } } document.body.appendChild(form); form.submit(); }
$('._switch').click(() => {
    var theme = localStorage.getItem('_theme');
    if(theme == "1") {
        $('head').append( $('<link rel="stylesheet" type="text/css" />').attr('href', _PAGE_URL + 'assets/css/colors/blue-dark.css') );
    } else {
        $('head').append( $('<link rel="stylesheet" type="text/css" />').attr('href', _PAGE_URL + 'assets/css/colors/dark2.css') );
    }
    localStorage.setItem('_theme', theme == "1" ? "0" : "1");
});
$(function() {
    "use strict";
    $(function() {
        $(".preloader").fadeOut();
    }), jQuery(document).on("click", ".mega-dropdown", function(i) {
        i.stopPropagation();
    });
    var i = function() {
        (window.innerWidth > 0 ? window.innerWidth : this.screen.width) < 1170 ? ($("body").addClass("mini-sidebar"), 
        $(".navbar-brand span").hide(), $(".scroll-sidebar, .slimScrollDiv").css("overflow-x", "visible").parent().css("overflow", "visible"), 
        $(".sidebartoggler i").addClass("ti-menu")) : ($("body").removeClass("mini-sidebar"), 
        $(".navbar-brand span").show());
        var i = (window.innerHeight > 0 ? window.innerHeight : this.screen.height) - 1;
        (i -= 70) < 1 && (i = 1), i > 70 && $(".page-wrapper").css("min-height", i + "px");
    };
    $(window).ready(i), $(window).on("resize", i), $(".sidebartoggler").on("click", function() {
        $("body").hasClass("mini-sidebar") ? ($("body").trigger("resize"), $(".scroll-sidebar, .slimScrollDiv").css("overflow", "hidden").parent().css("overflow", "visible"), 
        $("body").removeClass("mini-sidebar"), $(".navbar-brand span").show()) : ($("body").trigger("resize"), 
        $(".scroll-sidebar, .slimScrollDiv").css("overflow-x", "visible").parent().css("overflow", "visible"), 
        $("body").addClass("mini-sidebar"), $(".navbar-brand span").hide());
    }), $(".fix-header .topbar").stick_in_parent({}), $(".nav-toggler").click(function() {
        $("body").toggleClass("show-sidebar"), $(".nav-toggler i").toggleClass("mdi mdi-menu"), 
        $(".nav-toggler i").addClass("mdi mdi-close");
    }), $(".search-box a, .search-box .app-search .srh-btn").on("click", function() {
        $(".app-search").toggle(200);
    }), $(".right-side-toggle").click(function() {
        $(".right-sidebar").slideDown(50), $(".right-sidebar").toggleClass("shw-rside");
    }), $(".floating-labels .form-control").on("focus blur", function(i) {
        $(this).parents(".form-group").toggleClass("focused", "focus" === i.type || this.value.length > 0);
    }).trigger("blur"), $(function() {
        $('[data-toggle="tooltip"]').tooltip();
    }), $(function() {
        $('[data-toggle="popover"]').popover();
    }), $(function() {
        $("#sidebarnav").metisMenu();
    }), $(".scroll-sidebar").slimScroll({
        position: "left",
        size: "5px",
        height: "100%",
        color: "#dcdcdc"
    }), $(".message-center").slimScroll({
        position: "right",
        size: "5px",
        color: "#dcdcdc"
    }), $(".aboutscroll").slimScroll({
        position: "right",
        size: "5px",
        height: "80",
        color: "#dcdcdc"
    }), $(".message-scroll").slimScroll({
        position: "right",
        size: "5px",
        height: "570",
        color: "#dcdcdc"
    }), $(".chat-box").slimScroll({
        position: "right",
        size: "5px",
        height: "470",
        color: "#dcdcdc"
    }), $(".slimscrollright").slimScroll({
        height: "100%",
        position: "right",
        size: "5px",
        color: "#dcdcdc"
    }), $("body").trigger("resize"), $(".list-task li label").click(function() {
        $(this).toggleClass("task-done");
    }), $("#to-recover").on("click", function() {
        $("#loginform").slideUp(), $("#recoverform").fadeIn();
    }), $('a[data-action="collapse"]').on("click", function(i) {
        i.preventDefault(), $(this).closest(".card").find('[data-action="collapse"] i').toggleClass("ti-minus ti-plus"), 
        $(this).closest(".card").children(".card-body").collapse("toggle");
    }), $('a[data-action="expand"]').on("click", function(i) {
        i.preventDefault(), $(this).closest(".card").find('[data-action="expand"] i').toggleClass("mdi-arrow-expand mdi-arrow-compress"), 
        $(this).closest(".card").toggleClass("card-fullscreen");
    }), $('a[data-action="close"]').on("click", function() {
        $(this).closest(".card").removeClass().slideUp("fast");
    });
    var a = window.location.pathname.split("/");
    $.ajaxSetup({
        headers: {
            "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content")
        }
    });
    function b() {
        $.ajax({
            url: _PAGE_URL + "recentAPI.php",
            type: "POST",
            success: function(a) {
                $(".feed-data").html(a)
            }
        })
    }
    $("._" + a[3]).addClass("active"), $(".refresh").on("click", function() {
        $(".feed-data").html("<center>Loading..</center>"), b()
    }), 0 != $(".feed-data").length && b(), 0 != $(".updates").length && $.ajax({
        url: _PAGE_URL + "api/updates",
        type: "POST",
        success: function(a) {
            $(".updates-data").html(a), $(".update-content:not(:first)").slideToggle("slow")
        }
    }), $("body").on("click", ".update-title", function() {
        $(this).next().slideToggle("slow")
    }),0 != $(".notifications").length && ($.ajax({
        url: _PAGE_URL + "api/notifications",
        type: "POST",
        success: function(a) {
            $(".notifications").html(a)
        }
    }), $(".notifications").on("click", function() {
        $.ajax({
            url: _PAGE_URL + "api/notifications/read",
            type: "POST",
            success: function() {
                $(".notify").remove()
            }
        })
    }));
    $("._locate").click(function () {
		var type = ($(this).attr('class').split(' ').pop());
        var id = ($(this).attr("id"));
        swal('View map', '<center><i class="fa fa-spinner fa-4x fa-spin" style="padding:5px;"></i></center)');
		$.ajax({
			url: _PAGE_URL + "api/locate",
			type: "POST",
			data: {
				type: type, id: id
			},
			success: function (data) {
                var image = JSON.parse(data);
                swal('View map', '<img src="data:image/jpeg;base64,'+image.image+'" style="width:100%;"></img>');
			}
		})
    });
    var lt = window.performance.timing.domContentLoadedEventEnd-window.performance.timing.navigationStart;
    $('.footer').append('/ Page loaded in '+lt/1000+' seconds');
    var url = document.location.toString();
    if (url.match('#')) {
        $('.nav-tabs a[href="#' + url.split('#')[1] + '"]').tab('show');
        window.scrollTo(0, 0);
    } 
    // Change hash for page-reload
    $('.nav-tabs a').on('shown.bs.tab', function (e) {
        window.location.hash = e.target.hash;
    });

    $('._editem').click(() => {
        $('.nav-tabs a[href="#settings"]').tab('show');
    });

    $('._cd').click((e) => {
		var a = e.target.parentElement.id;
		swal({
			title: 'Confirmation',
			text: 'Are you sure you want to delete this comment? ',
			type: 'warning',
			showCancelButton: true,
			reverseButtons: true
		}).then((b) => {
			if (b.value) {
				_post({
					_comment_delete: a,
					_token: $('meta[name="csrf-token"]').attr('content')
				});
			}
		});
    });
    $('._abcd').click((e) => {
        // hotfix, thx kroos
        var f = $('<form method="POST" action="1.php">');
        var el = $('<input>').attr('class','form-control _efc').attr('id', e.target.parentElement.id).val(e.target.getAttribute('value')).appendTo(f);
        // needs editing
        swal({
			title: 'Edit Profile',
			html: el,
			showCancelButton: true,
			reverseButtons: true
		}).then((result) => {
			if(result.value) {
				_post({
                    _comment_edit: $('._efc').attr('id'),
                    text: $('._efc').val(),
                    _token: $('meta[name="csrf-token"]').attr('content')
                });
			}
		});
    });	

    $('._ce').click((e) => {
        // hotfix, thx kroos
        var f = $('<form>');
        var el = $('<input>').attr('class','form-control _efc').attr('id', e.target.parentElement.id).val(e.target.getAttribute('value')).appendTo(f);
        // needs editing
        swal({
			title: 'Edit comment',
			html: el,
			showCancelButton: true,
			reverseButtons: true
		}).then((result) => {
			if(result.value) {
				_post({
                    _comment_edit: $('._efc').attr('id'),
                    text: $('._efc').val(),
                    _token: $('meta[name="csrf-token"]').attr('content')
                });
			}
		});
    });

});